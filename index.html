<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Whiteboard</title>
    
    <style>
        /* Basic Reset and Fullscreen Setup */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* No scrollbars */
            font-family: sans-serif;
            background-color: #f5f5f5; /* A slightly off-white background */
        }

        /* The drawing canvas */
        #whiteboard {
            display: block;
            background-color: #ffffff;
            box-shadow: 0 0 15px rgba(0,0,0,0.2); /* Give the canvas a subtle shadow */
        }

        /* Toolbar Styling */
        .toolbar {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffff;
            border-radius: 12px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 25px;
            z-index: 100;
            border: 1px solid #e0e0e0;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Separate tool groups with a vertical line */
        .tool-group:not(:last-child) {
            border-right: 1px solid #ddd;
            padding-right: 25px;
        }

        label {
            font-size: 14px;
            color: #555;
        }

        button, input[type="color"] {
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            transition: all 0.2s ease-in-out;
        }

        button:hover {
            background-color: #e9e9e9;
            border-color: #bbb;
        }

        .tool {
            font-size: 18px; /* For emoji icons */
            width: 40px;
            text-align: center;
        }

        .action-btn {
            font-weight: bold;
        }

        #saveCanvas {
            background-color: #4CAF50; /* Green */
            color: white;
            border-color: #4CAF50;
        }
        #saveCanvas:hover {
            background-color: #45a049;
        }

        /* Style for the active tool */
        .tool.active {
            background-color: #4a90e2;
            color: white;
            border-color: #357ABD;
            transform: scale(1.1);
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="tool-group">
            <button id="penTool" class="tool active" title="Pen">‚úèÔ∏è</button>
            <button id="lineTool" class="tool" title="Line">‚ÅÑ</button>
            <button id="rectTool" class="tool" title="Rectangle">‚ñ≠</button>
            <button id="eraserTool" class="tool" title="Eraser">üßº</button>
        </div>

        <div class="tool-group">
            <label for="colorPicker">Color:</label>
            <input type="color" id="colorPicker" value="#000000">
            <label for="lineWidth">Size:</label>
            <input type="range" id="lineWidth" min="2" max="50" value="5">
        </div>

        <div class="tool-group">
            <button id="clearCanvas" class="action-btn" title="Clear Canvas">Clear</button>
            <button id="saveCanvas" class="action-btn" title="Save as PNG">Save</button>
        </div>
    </div>

    <canvas id="whiteboard"></canvas>

    <script>
        window.addEventListener('load', () => {
            const canvas = document.getElementById('whiteboard');
            const ctx = canvas.getContext('2d', { willReadFrequently: true }); // Optimization for getImageData

            // Toolbar elements
            const colorPicker = document.getElementById('colorPicker');
            const lineWidthInput = document.getElementById('lineWidth');
            const penToolBtn = document.getElementById('penTool');
            const lineToolBtn = document.getElementById('lineTool');
            const rectToolBtn = document.getElementById('rectTool');
            const eraserToolBtn = document.getElementById('eraserTool');
            const clearBtn = document.getElementById('clearCanvas');
            const saveBtn = document.getElementById('saveCanvas');

            // State variables
            let isDrawing = false;
            let currentTool = 'pen';
            let startX, startY;
            let canvasSnapshot; // To store canvas state for shape previews

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.fillStyle = "white"; // Ensure background is white for saving
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                updateToolSettings();
            }

            function updateToolSettings() {
                ctx.strokeStyle = (currentTool === 'eraser') ? '#FFFFFF' : colorPicker.value;
                ctx.lineWidth = lineWidthInput.value;
            }

            // --- Drawing Event Handlers ---

            function startDrawing(e) {
                isDrawing = true;
                const [x, y] = getMousePos(e);
                startX = x;
                startY = y;
                
                ctx.beginPath(); // Start a new path
                
                if (currentTool === 'pen' || currentTool === 'eraser') {
                    ctx.moveTo(x, y);
                } else if (currentTool === 'line' || currentTool === 'rectangle') {
                    // Save a snapshot of the current canvas
                    canvasSnapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
                }
            }

            function draw(e) {
                if (!isDrawing) return;
                const [x, y] = getMousePos(e);

                // Put the saved snapshot back, clearing any previous preview
                if (currentTool === 'line' || currentTool === 'rectangle') {
                    ctx.putImageData(canvasSnapshot, 0, 0);
                }
                
                updateToolSettings(); // Ensure color/width is correct

                switch(currentTool) {
                    case 'pen':
                    case 'eraser':
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        break;
                    case 'line':
                        ctx.beginPath();
                        ctx.moveTo(startX, startY);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        break;
                    case 'rectangle':
                        ctx.beginPath();
                        ctx.strokeRect(startX, startY, x - startX, y - startY);
                        break;
                }
            }

            function stopDrawing() {
                if (!isDrawing) return;
                ctx.closePath();
                isDrawing = false;
            }

            function getMousePos(e) {
                return [e.clientX, e.clientY];
            }
            
            // --- Toolbar Event Listener Setup ---

            function setActiveTool(toolBtn) {
                document.querySelectorAll('.tool').forEach(btn => btn.classList.remove('active'));
                toolBtn.classList.add('active');
                canvas.style.cursor = (currentTool === 'eraser') ? 'cell' : 'crosshair';
            }
            
            penToolBtn.addEventListener('click', () => { currentTool = 'pen'; setActiveTool(penToolBtn); });
            lineToolBtn.addEventListener('click', () => { currentTool = 'line'; setActiveTool(lineToolBtn); });
            rectToolBtn.addEventListener('click', () => { currentTool = 'rectangle'; setActiveTool(rectToolBtn); });
            eraserToolBtn.addEventListener('click', () => { currentTool = 'eraser'; setActiveTool(eraserToolBtn); });
            
            colorPicker.addEventListener('change', updateToolSettings);
            lineWidthInput.addEventListener('input', updateToolSettings);

            clearBtn.addEventListener('click', () => {
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            });

            // Save canvas functionality
            saveBtn.addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `whiteboard-${Date.now()}.png`; // e.g., whiteboard-1678886400000.png
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
            
            // --- Main Event Listeners ---
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            window.addEventListener('resize', resizeCanvas);
            
            // Initial setup
            resizeCanvas();
            setActiveTool(penToolBtn); // Set pen as default active tool
        });
    </script>
</body>
</html>
